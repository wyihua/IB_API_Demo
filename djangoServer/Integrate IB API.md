#### 接下来可能要做的工作有：
1.	想办法能够让按钮触发后台的python程序（可能是按钮触发一个HTTP）
2.	URL是否可以触发python脚本？（有一个简单的办法是index函数里面加入调用脚本文件的函数）
3.	不管怎么做，我们都要把IB的脚本运行文件加入到Django里面
4.	需要调用的函数现在是搜集数据
5.	我们可能可以在index函数里面获得ib所搜集到的数据
6.	然后在index函数里面，把数据储存进入数据库

#### 稍微整理总结一下，就是：
1.	把之前的关于IB的脚本添加到Django服务器上面
2.	通过index调用脚本，搜集数据，并且输出数据

## 写一个获得市场数据的函数
#### 现在的情况是：
我们已经能够成功地从django服务器调用IB api文件里面的函数了。但是问题在于，我们没有独立的获取数据的函数。之前获取数据的功能是写在main函数里面的。

#### 所以我们现在需要创建一个独立的函数，用来获取市场数据：
1.	在demo文件里面创建一个函数（或者把主函数名字改了）
2.	声明连接、contract之类的变量
3.	注册handler
4.	看看是否有打印结果


#### 现在大致完成了上面的工作：
我们其实需要做的是写两个函数，分别是搜集数据和下单。

#### 写完这两个函数之后，我们需要想的是一个完整的数据链：
HTTP -> index() -> getMktData -> index.saveData()

#### 仔细上面的数据链的流程：
1.	HTTP->index，已完成
2.	Index -> getMktData，基本已完成，只是需要在getMktData函数本身获得数据，而不是在handler里面（可能需要采用异步的方式调用函数）
3.	把getMktData里面的数据传回index（需要以第二步作为基础）
4.	想办法储存数据

其中第二步、第四步目前不知道该怎么做。第四步知道教程在哪。唯一不确定的是第二步。


#### 关于下单的触发流程：
需要谷歌一下方法。（暂时不考虑）

## 如何在GETMKTDATA函数自身里面获得HANDLER的数据
现在想到的办法是创造一个全局变量。
结果handler函数不能接触到文件里面的全局变量。

#### 问题陈述：
我希望的是能够将获得的股票数据传回index函数。
那么我就需要获得股票的数据。
而现在股票的数据只能通过handler给打印出来，handler不能传递数据。

#### 现在需要想办法让handler传递数据。
我们怎么让handler改变任何python中的变量？
目前明显能够做到的是保存成本地文件，但是这个方法不推荐。

使用callback函数。

## 研究如何使用CALLBACK函数
根据南洋理工的教程，这个callback函数是和pd一起用来输出数据的。

#### Callback是怎么绑定API的？
tws_connect是通过callback注册出来的。这里我们不使用register handler的方法，而是在声明tws的时候绑定callback。

#### 结果
现在我们已经能够在index里面获得市场数据了

#### 接下来要做的工作有：
1.	在index里面使用异步来调用api，防止延迟
2.	在getMktData函数里面，将获取的市场数据储存成ticket对象
3.	在template里面把数据属性给显示出来

第三步是最容易的，只需要确定显示的属性就行

## 在TEMPLATE里面显示所有的属性
已经完成

## 在PYTHON里面采用异步调用
#### 参看文档：
https://www.tutorialspoint.com/python/python_multithreading.htm

#### 要做的工作：
已经完成。

## 在数据库里面储存TICKET数据

到了这里，其实文档信息并不明确。我们现在的任务是在Django里面对已经存在的table增加数据。
#### 我们现在的选择有：
1.	研究之前的admin储存，或者shell储存，看看这些是否是通过代码储存数据的
2.	尝试直接加入到sql里面
3.	找找看如何在django里面增加绑定的数据的方法

#### 现在可行的做法是：
首先研究第一个选项，如果之前的方法能够告诉我们如何通过代码储存，那么我们就使用那个方法。如果找不到合适的方法，那么我们就优先尝试第三种方法。

#### 我有一个想法
现在发现admin是通过register model实现的。这个不可行。
我想到的是也许我们能够在python脚本文件里面采用shell里面同样的语句来储存对象。

我的猜想是对的。

## 接下来的问题是删除数据
因为我不能每次都打开网页的时候就加入一个新的数据，然后就全都保留在那儿。
虽然我们可以不通过按钮的方式，实现有效的控制UI上面的数量，但是为了正常工作，我需要写两个按钮：
1.	清空数据库
2.	增加新的数据


## 研究如何让按钮触发DJANGO里面的函数
#### 参考链接：
https://stackoverflow.com/questions/17599035/django-how-can-i-call-a-view-function-from-template/19761466#19761466

成功了。。。。。。。。

#### 已经实现了两个按钮的基本功能

#### 但是有漏洞：
就是按钮的请求，在刷新之后，仍然会自动发送这个请求。
准确的说是：
1.	对于删除数据的按钮，点击之后就立即删除数据了（也就是说立即发出信号了，并且信号被处理了）
2.	对于增加数据的按钮，第一次点击之后，立即增加数据，但之后重复点击，发现并不能增加数据。反而刷新界面之后，发现增加数据。（也就是说，只有第一次点击input按钮，会发出请求，之后只有刷新才会发送请求）

#### 猜想：
我猜会不会是因为按钮被点击之后，input元素的请求会储存在浏览器里面，只有刷新界面才会发送。


#### form的action是什么？
是要处理请求的（处理器）文件的URL。#应该是指的当前的文件。

尝试使用button，而不是input发送请求。

## 把PD的数据储存进PYTHON
现在遇到的问题是，当我尝试遍历返回的pd对象的时候。现在能做到的是遍历所有的item，却不能把所有的item储存起来。

#### 原因是：
tickerId并不是元素的index。
tickerId是1002。

#### 另外两个问题：
1.	Price是有理数，而不是整数
2.	是ask_price而不是ask_size

已改好上述问题，现在需要重新migrate数据库

